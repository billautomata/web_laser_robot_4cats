<html class="no-js">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="css/bootstrap.min.css">
  <style>
    body {
      padding: 0px;
      overflow: hidden;
    }
  </style>
  <link rel="stylesheet" href="css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="css/main.css">

  <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
</head>

<body>

  <div class="row text-center">
    <svg style='width:100%;'></svg>
  </div>
  <div class='col-xs-12'>
    <button id='wander_mode' type="submit" class="btn btn-default">wander mode</button>
    <a href='/setup'>
      <button id='wander_mode' type="submit" class="btn btn-default">settings</button>
    </a>
  </div>

  <script src='js/vendor/jquery-1.11.1.min.js'></script>
  <script src="js/vendor/bootstrap.min.js"></script>

  <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
  <script>
    // (function(b, o, i, l, e, r) {
    //   b.GoogleAnalyticsObject = l;
    //   b[l] || (b[l] =
    //     function() {
    //       (b[l].q = b[l].q || []).push(arguments)
    //     });
    //   b[l].l = +new Date;
    //   e = o.createElement(i);
    //   r = o.getElementsByTagName(i)[0];
    //   e.src = '//www.google-analytics.com/analytics.js';
    //   r.parentNode.insertBefore(e, r)
    // }(window, document, 'script', 'ga'));
    // ga('create', 'UA-XXXXX-X');
    // ga('send', 'pageview');
  </script>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io.connect(window.location.origin)
  </script>

  <script src="js/main.js"></script>

  <script>
    var x_coord = 70
    var y_coord = 70

    var svg = d3.select('svg').attr('height', window.innerHeight * 0.8)

    var drag = d3.behavior.drag()
      .origin(function(d) {
        return d;
      })
      .on("drag", dragmove)
      .on("dragstart", dragmove)

    svg.selectAll('rect').data([0])
      .enter()
      .append('rect')
      .attr('x', 0).attr('y', 0)
      .attr('width', '100%')
      .attr('height', '100%')
      .attr('fill', d3.rgb(100, 100, 100))
      .call(drag)

    var scalex = d3.scale.linear()
      .domain([0, window.innerWidth])
      .range([window.servo_settings.x_min, window.servo_settings.x_max])
      .clamp(true)

    var scaley = d3.scale.linear()
      .domain([0, window.innerHeight])
      .range([window.servo_settings.y_min, window.servo_settings.y_max])
      .clamp(true)

    // on screen indicator
    var circle = svg.append('circle').attr('id', 'laser_position')
      .attr('cx', scalex.invert(x_coord, true))
      .attr('cy', scaley.invert(y_coord, true))
      .attr('r', window.innerWidth * 0.05)
      .attr('stroke', 'none')
      .attr('fill', 'white')
      .attr('fill-opacity', 0.9)

    function dragmove() {

      // console.log(d3.event)

      if(d3.event.sourceEvent.targetTouches !== undefined){
        if(d3.event.sourceEvent.targetTouches.length > 0){
          //console.log(d3.event.sourceEvent.targetTouches)
          x_coord = Math.floor(scalex(d3.event.sourceEvent.targetTouches[0].pageX))
          y_coord = Math.floor(scaley(d3.event.sourceEvent.targetTouches[0].pageY))
        }
      } else {
        x_coord = Math.floor(scalex(d3.event.sourceEvent.pageX))
        y_coord = Math.floor(scaley(d3.event.sourceEvent.pageY))
      }

      // from main.js
      send_coordinate([x_coord, y_coord])

      // update the position of the indicator circle
      circle.attr('cx', scalex.invert(x_coord))
        .attr('cy', scaley.invert(y_coord))

    }

    d3.select('button#wander_mode').on('click', function() {
      wander_mode()
    })

    var wander_interval
    var wander_mode_active = false

    function wander_mode() {

      if (wander_mode_active) {

        wander_mode_active = false
        clearInterval(wander_interval)

      } else {

        wander_mode_active = true
        wander_interval = setInterval(function() {

          var range = Math.random() * 2 + 1
          var range_2 = range / 2.0

          x_coord += Math.floor((Math.random() * range) - range_2 + 0.5)
          y_coord += Math.floor((Math.random() * range) - range_2 + 0.5)

          if (x_coord < window.servo_settings.x_min) {
            x_coord = window.servo_settings.x_min
          }
          if (x_coord > window.servo_settings.x_max) {
            x_coord = window.servo_settings.x_max
          }

          if (y_coord < window.servo_settings.y_min) {
            y_coord = window.servo_settings.y_min
          }
          if (y_coord > window.servo_settings.y_max) {
            y_coord = window.servo_settings.y_max
          }

          circle.attr('cx', scalex.invert(x_coord))
            .attr('cy', scaley.invert(y_coord))
            .attr('r', window.innerWidth * 0.05)

          send_coordinate([x_coord, y_coord])

        }, 100)

      }

    }
  </script>


</body>

</html>
